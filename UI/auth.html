<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jobarium UI - Sign Up or Log In</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="glass-style.css">
</head>
<body class="glass-theme">
  <div class="bg-orb orb-c" aria-hidden="true"></div>
  <main class="layout">
    <section class="container">
      <h1 class="auth-brand"><span class="auth-brand-strong">job</span><span class="auth-brand-thin">arium</span><span class="auth-brand-tm">TM</span></h1>
      <article class="card auth-glass-card">
        <div class="auth-title-row">
          <div class="auth-title-meta">
            <h1 id="authTitle">Log in</h1>
            <p class="muted" id="authSubtitle">Access your account with minimal friction.</p>
          </div>
          <div class="auth-mode-switch">
            <span class="auth-mode-blob" aria-hidden="true"><span class="auth-mode-blob-core"></span></span>
            <button id="loginTab" class="btn">Log in</button>
            <button id="signupTab" class="btn secondary">Sign up</button>
          </div>
        </div>

        <form id="authForm" class="auth-form">
          <label for="email">Email</label>
          <input id="email" class="input" type="email" autocomplete="email" required>

          <label for="password">Password</label>
          <input id="password" class="input" type="password" autocomplete="current-password" required>

          <div class="actions auth-primary-actions">
            <button class="btn" type="submit" id="primaryAction">Log in</button>
          </div>
        </form>


        <div class="actions oauth-actions">
          <button class="btn ghost oauth-btn google" id="googleBtn" type="button">
            <svg class="oauth-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M21.35 11.1h-9.18v2.92h5.27c-.24 1.5-1.8 4.4-5.27 4.4-3.17 0-5.75-2.63-5.75-5.87s2.58-5.87 5.75-5.87c1.8 0 3 .77 3.69 1.43l2.52-2.46C16.77 4.15 14.67 3.2 12.17 3.2 7.2 3.2 3.2 7.3 3.2 12.35s4 9.15 8.97 9.15c5.18 0 8.6-3.63 8.6-8.75 0-.59-.07-1.04-.15-1.65z"/>
            </svg>
            <span>Continue with Google</span>
          </button>
          <button class="btn ghost oauth-btn linkedin" id="linkedinBtn" type="button">
            <svg class="oauth-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M19 3A2 2 0 0 1 21 5v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14zm-9.5 6.5H6.75V18h2.75V9.5zM8.13 6.3a1.6 1.6 0 1 0 0 3.2 1.6 1.6 0 0 0 0-3.2zM18 12.6c0-2.67-1.43-3.9-3.34-3.9-1.54 0-2.23.84-2.61 1.43V9.5H9.31V18h2.74v-4.2c0-1.11.21-2.19 1.58-2.19 1.35 0 1.37 1.26 1.37 2.26V18H18v-5.4z"/>
            </svg>
            <span>Continue with LinkedIn</span>
          </button>
        </div>
      </article>
      <div class="auth-status-outside">
        <div class="status-box hidden" data-status role="status" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <script src="app.js"></script>
  <script>
    UIFlow.guard("auth");
    const state = UIFlow.readState();
    const params = new URLSearchParams(location.search);
    let mode = params.get("mode") === "signup" ? "signup" : "login";
    const signupTab = document.getElementById("signupTab");
    const loginTab = document.getElementById("loginTab");
    const action = document.getElementById("primaryAction");
    const form = document.getElementById("authForm");
    const title = document.getElementById("authTitle");
    const subtitle = document.getElementById("authSubtitle");
    const modeSwitch = document.querySelector(".auth-mode-switch");
    const authCard = document.querySelector(".auth-glass-card");
    const statusEl = document.querySelector("[data-status]");
    let statusFadeTimer = null;
    let statusHideTimer = null;
    let switchAnimTimer = null;

    function clearStatusTimers() {
      window.clearTimeout(statusFadeTimer);
      window.clearTimeout(statusHideTimer);
      statusFadeTimer = null;
      statusHideTimer = null;
    }

    function showStatusPersistent(kind, message) {
      clearStatusTimers();
      if (statusEl) statusEl.classList.remove("fade-out");
      UIFlow.showStatus(kind, message);
      triggerCardFlash(kind);
    }

    function showStatusTransient(kind, message, duration = 3000) {
      clearStatusTimers();
      if (statusEl) statusEl.classList.remove("fade-out");
      UIFlow.showStatus(kind, message);
      triggerCardFlash(kind);
      statusFadeTimer = window.setTimeout(() => {
        if (statusEl) statusEl.classList.add("fade-out");
      }, Math.max(0, duration - 260));
      statusHideTimer = window.setTimeout(() => {
        UIFlow.hideStatus();
        if (statusEl) statusEl.classList.remove("fade-out");
      }, duration);
    }

    function triggerCardFlash(kind) {
      if (!authCard) return;
      const flashPalette = {
        loading: "rgba(124, 153, 255, 0.28)",
        empty: "rgba(180, 196, 255, 0.24)",
        "error-recoverable": "rgba(247, 184, 73, 0.28)",
        "error-blocking": "rgba(248, 113, 113, 0.3)",
        success: "rgba(45, 212, 191, 0.28)"
      };
      authCard.style.setProperty("--flash-color", flashPalette[kind] || "rgba(130, 156, 255, 0.28)");
      authCard.classList.remove("status-flash");
      void authCard.offsetWidth;
      authCard.classList.add("status-flash");
    }

    function getRoleLabel() {
      return state.userType === "employer" ? "Employer" : "Candidate";
    }

    function renderMode(previousMode = mode) {
      const isSignup = mode === "signup";
      signupTab.className = isSignup ? "btn" : "btn secondary";
      loginTab.className = isSignup ? "btn secondary" : "btn";
      action.textContent = isSignup ? "Create account" : "Log in";
      title.textContent = getRoleLabel();
      subtitle.textContent = state.userType === "employer"
        ? "Access your workspace setup and job automation flow."
        : "Access your matched opportunity and profile onboarding flow.";

      if (!modeSwitch) return;
      modeSwitch.dataset.mode = mode;
      modeSwitch.classList.remove("moving-left", "moving-right");

      if (previousMode !== mode) {
        modeSwitch.classList.add(mode === "signup" ? "moving-right" : "moving-left");
        window.clearTimeout(switchAnimTimer);
        switchAnimTimer = window.setTimeout(() => {
          modeSwitch.classList.remove("moving-left", "moving-right");
        }, 320);
      }
    }

    signupTab.addEventListener("click", () => {
      const previousMode = mode;
      mode = "signup";
      renderMode(previousMode);
    });
    loginTab.addEventListener("click", () => {
      const previousMode = mode;
      mode = "login";
      renderMode(previousMode);
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      showStatusPersistent("loading", "Validating credentials...");
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      setTimeout(() => {
        if (!email || !password) {
          showStatusPersistent("error-recoverable", "Please enter email and password.");
          return;
        }
        if (mode === "signup" && email.endsWith("@duplicate.com")) {
          showStatusPersistent("error-recoverable", "This email already exists. Try log in.");
          return;
        }

        UIFlow.updateState({
          authEmail: email,
          consentAccepted: false,
          emailVerified: false,
          consentSet: []
        });
        showStatusPersistent("success", mode === "signup" ? "Account created. Continue to consent." : "Login successful. Continue to consent check.");
        UIFlow.showToast("Auth step complete.");
        setTimeout(() => location.href = "consent.html", 650);
      }, 750);
    });

    document.getElementById("googleBtn").addEventListener("click", () => {
      UIFlow.updateState({ authEmail: "oauth.google@jobarium.demo", consentAccepted: false, emailVerified: false, consentSet: [] });
      UIFlow.showToast("Google account linked. Continue to consent.");
      setTimeout(() => location.href = "consent.html", 450);
    });

    document.getElementById("linkedinBtn").addEventListener("click", () => {
      UIFlow.updateState({ authEmail: "oauth.linkedin@jobarium.demo", consentAccepted: false, emailVerified: false, consentSet: [] });
      UIFlow.showToast("LinkedIn account linked. Continue to consent.");
      setTimeout(() => location.href = "consent.html", 450);
    });

    function initLightPhysics() {
      const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)");
      if (prefersReducedMotion.matches) return;

      const root = document.documentElement;
      let lagX = 0;
      let lagY = 0;
      let prevX = 0;
      let prevY = 0;

      function setVar(name, value) {
        root.style.setProperty(name, value);
      }

      function lerp(a, b, t) {
        return a + (b - a) * t;
      }

      function triLerp(leftValue, middleValue, rightValue, p) {
        if (p <= 0.5) return lerp(leftValue, middleValue, p * 2);
        return lerp(middleValue, rightValue, (p - 0.5) * 2);
      }

      function frame(now) {
        // A few low-frequency waves create organic spotlight drift.
        const lightX =
          52 * Math.sin(now * 0.00011) +
          28 * Math.sin(now * 0.00023 + 1.2) +
          16 * Math.sin(now * 0.00041 + 2.3);
        const lightY =
          34 * Math.sin(now * 0.00009 + 0.7) +
          22 * Math.sin(now * 0.00019 + 2.1) +
          14 * Math.sin(now * 0.00037 + 0.2);

        // Low-pass lag gives inertia and avoids robotic motion.
        lagX += (lightX - lagX) * 0.06;
        lagY += (lightY - lagY) * 0.06;

        const vx = lagX - prevX;
        const vy = lagY - prevY;
        prevX = lagX;
        prevY = lagY;

        const speed = Math.min(1, Math.hypot(vx, vy) / 1.6);

        // Backdrop spotlights (light source field).
        setVar("--orb-a-x", `${(lagX * 1.0).toFixed(2)}px`);
        setVar("--orb-a-y", `${(lagY * 0.72).toFixed(2)}px`);
        setVar("--orb-b-x", `${(-lagX * 0.86).toFixed(2)}px`);
        setVar("--orb-b-y", `${(-lagY * 0.58).toFixed(2)}px`);
        setVar("--orb-c-x", `${(lagX * 0.62 - lagY * 0.22).toFixed(2)}px`);
        setVar("--orb-c-y", `${(lagY * 0.9).toFixed(2)}px`);

        // Glass response:
        // - top edge + specular streak: mostly opposite direction (reflection)
        // - broad card wash: same direction, lower gain (refraction)
        const reflectX = -1.8 * lagX + 3.8 * vx;
        const refractX = 1.22 * lagX + 0.1 * vx;
        const refractY = 0.07 * lagY + 0.1 * vy;
        const normalized = Math.max(-1, Math.min(1, lagX / 60));
        const p = (normalized + 1) / 2;

        // Gradient morph (left -> middle -> right) to mimic changing refraction shape.
        const stopA = triLerp(0, 40, 10, p);
        const stopB = triLerp(20, 50, 100, p);
        const stopC = triLerp(5, 15, 5, p);
        const stopD = triLerp(15, 50, 50, p);
        const refractAngle = -16 * normalized;

        setVar("--card-reflect-x", `${reflectX.toFixed(2)}px`);
        setVar("--card-reflect-o", (0.9 + speed * 0.12).toFixed(3));
        setVar("--card-refract-x", `${refractX.toFixed(2)}px`);
        setVar("--card-refract-y", `${refractY.toFixed(2)}px`);
        setVar("--card-refract-o", (0.36 + speed * 0.12).toFixed(3));
        setVar("--card-refract-angle", `${refractAngle.toFixed(2)}deg`);
        setVar("--refract-stop-a", `${stopA.toFixed(2)}%`);
        setVar("--refract-stop-b", `${stopB.toFixed(2)}%`);
        setVar("--refract-stop-c", `${stopC.toFixed(2)}%`);
        setVar("--refract-stop-d", `${stopD.toFixed(2)}%`);

        window.requestAnimationFrame(frame);
      }

      window.requestAnimationFrame(frame);
    }

    renderMode();
    initLightPhysics();
    showStatusPersistent("loading", "Loading auth config...");
    setTimeout(() => showStatusTransient("success", "Auth config loaded. Choose sign up or log in.", 3000), 420);
  </script>
</body>
</html>
